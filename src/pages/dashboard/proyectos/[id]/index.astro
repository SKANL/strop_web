---
// dashboard/proyectos/[id]/index.astro - Página de Detalle de Proyecto
import DashboardLayout from "@/layouts/DashboardLayout.astro";
import { FloatingNav } from "@/components/dashboard/islands/FloatingNav";
import { MobileNav } from "@/components/dashboard/islands/MobileNav";
import { RightSidebar } from "@/components/dashboard/islands/RightSidebar";
import { ProjectDetail } from "@/components/dashboard/projects/detail/ProjectDetail";
import { 
  getProjectWithStatsById, 
  getProjectMembersWithDetailsUI,
  getCriticalPathByProject,
  getIncidentsByProject,
  mockProjectsWithStats
} from "@/lib/mock";

// getStaticPaths para generación estática de todas las rutas de proyectos
export function getStaticPaths() {
  return mockProjectsWithStats.map((project) => ({
    params: { id: project.id },
  }));
}

// Obtener el ID del proyecto de la URL
const { id } = Astro.params;

// Buscar el proyecto
const project = getProjectWithStatsById(id || "");

// Si no existe, redirigir a la lista
if (!project) {
  return Astro.redirect("/dashboard/proyectos");
}

// Obtener datos relacionados
const members = getProjectMembersWithDetailsUI(project.id);
const criticalPath = getCriticalPathByProject(project.id);
const incidents = getIncidentsByProject(project.id);

const currentPath = `/dashboard/proyectos/${id}`;
---

<DashboardLayout 
  title={`${project.name} | Strop`} 
  description={`Detalle del proyecto ${project.name}`}
>
  <div class="flex min-h-screen w-full bg-[#fafafa] overflow-hidden relative">
    {/* Patrón de fondo */}
    <div 
      class="absolute inset-0 opacity-[0.03] pointer-events-none" 
      style={{ 
        backgroundImage: "radial-gradient(#000 1px, transparent 1px)", 
        backgroundSize: "24px 24px" 
      }} 
    />

    {/* Navegación Flotante (Desktop) */}
    <div class="hidden md:block">
      <FloatingNav client:idle currentPath={currentPath} />
    </div>

    {/* Navegación Móvil */}
    <MobileNav client:idle currentPath={currentPath} />

    {/* Panel Lateral Derecho */}
    <RightSidebar client:idle />

    {/* Contenido Principal */}
    <main class="flex-1 h-screen overflow-y-auto relative z-0">
      <div class="p-4 md:p-8 pt-16 md:pt-8 pl-4 md:pl-32 pr-4 md:pr-28 max-w-7xl mx-auto min-h-screen relative z-10">
        <ProjectDetail 
          client:load 
          project={project}
          members={members}
          criticalPath={criticalPath}
          incidents={incidents}
        />
      </div>
    </main>
  </div>
</DashboardLayout>
