---
// dashboard/proyectos/[id]/index.astro - Página de Detalle de Proyecto
import DashboardLayout from "@/layouts/DashboardLayout.astro";
import { ProjectDetail } from "@/features/projects/components/detail/ProjectDetail";
import { 
  getProjectWithStatsById, 
  getProjectMembersWithDetailsUI,
  getIncidentsByProject,
  mockProjectsWithStats
} from "@/lib/mock";

// getStaticPaths para generación estática de todas las rutas de proyectos
export function getStaticPaths() {
  return mockProjectsWithStats.map((project) => ({
    params: { id: project.id },
  }));
}

// Obtener el ID del proyecto de la URL
const { id } = Astro.params;

// Buscar el proyecto
const project = getProjectWithStatsById(id || "");

// Si no existe, redirigir a la lista
if (!project) {
  return Astro.redirect("/dashboard/proyectos");
}

// Obtener datos relacionados
const members = getProjectMembersWithDetailsUI(project.id);
const incidents = getIncidentsByProject(project.id);
---

<DashboardLayout 
  title={`${project.name} | Strop`} 
  description={`Detalle del proyecto ${project.name}`}
>
  <ProjectDetail 
    client:load 
    project={project}
    members={members}
    incidents={incidents}
  />
</DashboardLayout>

